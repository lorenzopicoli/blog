{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "",

  "signals": [
    {
      "name": "step",
      "update": "width / 53"
    },
    {
      "name": "offset",
      "update": "step / 3"
    },
    {
      "name": "height",
      "update": "step * 7"
    },
    {
      "name": "scheme",
      "value": "purples"
    }
  ],

  "data": [
    {
      "name": "data",
      "values": [
        { "date": "2024-1-1", "count": 4 },
        { "date": "2024-1-2", "count": 17 },
        { "date": "2024-1-3", "count": 45 },
        { "date": "2024-1-4", "count": 22 },
        { "date": "2024-1-5", "count": 80 },
        { "date": "2024-1-6", "count": 12 },
        { "date": "2024-1-7", "count": 22 },
        { "date": "2024-1-8", "count": 5 },
        { "date": "2024-1-9", "count": 22 },
        { "date": "2024-1-10", "count": 7 },
        { "date": "2024-1-11", "count": 5 },
        { "date": "2024-1-12", "count": 8 },
        { "date": "2024-1-14", "count": 23 },
        { "date": "2024-1-15", "count": 27 },
        { "date": "2024-1-16", "count": 32 },
        { "date": "2024-1-17", "count": 16 },
        { "date": "2024-1-18", "count": 2 },
        { "date": "2024-1-19", "count": 80 },
        { "date": "2024-1-20", "count": 60 },
        { "date": "2024-1-21", "count": 40 },
        { "date": "2024-1-22", "count": 27 },
        { "date": "2024-1-24", "count": 22 },
        { "date": "2024-1-25", "count": 33 },
        { "date": "2024-1-26", "count": 56 },
        { "date": "2024-1-30", "count": 14 },
        { "date": "2024-1-31", "count": 43 },
        { "date": "2024-2-1", "count": 26 },
        { "date": "2024-2-2", "count": 24 },
        { "date": "2024-2-3", "count": 13 },
        { "date": "2024-2-4", "count": 14 },
        { "date": "2024-2-5", "count": 33 },
        { "date": "2024-2-6", "count": 74 },
        { "date": "2024-2-8", "count": 28 },
        { "date": "2024-2-9", "count": 6 },
        { "date": "2024-2-10", "count": 45 },
        { "date": "2024-2-13", "count": 3 },
        { "date": "2024-2-15", "count": 3 },
        { "date": "2024-2-17", "count": 1 },
        { "date": "2024-2-19", "count": 2 },
        { "date": "2024-2-21", "count": 29 },
        { "date": "2024-2-22", "count": 64 },
        { "date": "2024-2-24", "count": 3 },
        { "date": "2024-2-25", "count": 13 },
        { "date": "2024-2-26", "count": 26 },
        { "date": "2024-2-27", "count": 20 },
        { "date": "2024-2-28", "count": 11 },
        { "date": "2024-2-29", "count": 22 },
        { "date": "2024-3-1", "count": 60 },
        { "date": "2024-3-2", "count": 18 },
        { "date": "2024-3-3", "count": 31 },
        { "date": "2024-3-4", "count": 94 },
        { "date": "2024-3-5", "count": 110 },
        { "date": "2024-3-6", "count": 52 },
        { "date": "2024-3-7", "count": 99 },
        { "date": "2024-3-8", "count": 45 },
        { "date": "2024-3-10", "count": 15 },
        { "date": "2024-3-11", "count": 42 },
        { "date": "2024-3-12", "count": 38 },
        { "date": "2024-3-13", "count": 26 },
        { "date": "2024-3-14", "count": 72 },
        { "date": "2024-3-15", "count": 44 },
        { "date": "2024-3-16", "count": 61 },
        { "date": "2024-3-17", "count": 33 },
        { "date": "2024-3-18", "count": 117 },
        { "date": "2024-3-19", "count": 24 },
        { "date": "2024-3-20", "count": 17 },
        { "date": "2024-3-21", "count": 8 },
        { "date": "2024-3-22", "count": 23 },
        { "date": "2024-3-23", "count": 2 },
        { "date": "2024-3-24", "count": 14 },
        { "date": "2024-3-25", "count": 43 },
        { "date": "2024-3-26", "count": 49 },
        { "date": "2024-3-27", "count": 61 },
        { "date": "2024-3-28", "count": 100 },
        { "date": "2024-3-29", "count": 41 },
        { "date": "2024-3-30", "count": 27 },
        { "date": "2024-3-31", "count": 48 },
        { "date": "2024-4-1", "count": 23 },
        { "date": "2024-4-2", "count": 33 },
        { "date": "2024-4-3", "count": 11 },
        { "date": "2024-4-4", "count": 55 },
        { "date": "2024-4-5", "count": 31 },
        { "date": "2024-4-6", "count": 47 },
        { "date": "2024-4-7", "count": 111 },
        { "date": "2024-4-8", "count": 32 },
        { "date": "2024-4-9", "count": 90 },
        { "date": "2024-4-10", "count": 64 },
        { "date": "2024-4-11", "count": 17 },
        { "date": "2024-4-12", "count": 98 },
        { "date": "2024-4-13", "count": 50 },
        { "date": "2024-4-14", "count": 52 },
        { "date": "2024-4-15", "count": 22 },
        { "date": "2024-4-16", "count": 50 },
        { "date": "2024-4-17", "count": 25 },
        { "date": "2024-4-18", "count": 23 },
        { "date": "2024-4-19", "count": 41 },
        { "date": "2024-4-20", "count": 12 },
        { "date": "2024-4-21", "count": 22 },
        { "date": "2024-4-22", "count": 34 },
        { "date": "2024-4-23", "count": 36 },
        { "date": "2024-4-24", "count": 90 },
        { "date": "2024-4-25", "count": 58 },
        { "date": "2024-4-26", "count": 47 },
        { "date": "2024-4-27", "count": 35 },
        { "date": "2024-4-28", "count": 16 },
        { "date": "2024-4-29", "count": 37 },
        { "date": "2024-4-30", "count": 25 },
        { "date": "2024-5-1", "count": 26 },
        { "date": "2024-5-2", "count": 3 },
        { "date": "2024-5-3", "count": 34 },
        { "date": "2024-5-5", "count": 5 },
        { "date": "2024-5-6", "count": 43 },
        { "date": "2024-5-7", "count": 18 },
        { "date": "2024-5-8", "count": 26 },
        { "date": "2024-5-9", "count": 22 },
        { "date": "2024-5-10", "count": 11 },
        { "date": "2024-5-11", "count": 27 },
        { "date": "2024-5-12", "count": 20 },
        { "date": "2024-5-13", "count": 44 },
        { "date": "2024-5-14", "count": 16 },
        { "date": "2024-5-15", "count": 19 },
        { "date": "2024-5-16", "count": 28 },
        { "date": "2024-5-17", "count": 70 },
        { "date": "2024-5-18", "count": 78 },
        { "date": "2024-5-20", "count": 5 },
        { "date": "2024-5-21", "count": 34 },
        { "date": "2024-5-22", "count": 54 },
        { "date": "2024-5-23", "count": 74 },
        { "date": "2024-5-24", "count": 53 },
        { "date": "2024-5-25", "count": 8 },
        { "date": "2024-5-26", "count": 90 },
        { "date": "2024-5-27", "count": 42 },
        { "date": "2024-5-28", "count": 68 },
        { "date": "2024-5-29", "count": 22 },
        { "date": "2024-5-30", "count": 26 },
        { "date": "2024-5-31", "count": 102 },
        { "date": "2024-6-1", "count": 64 },
        { "date": "2024-6-2", "count": 3 },
        { "date": "2024-6-3", "count": 47 },
        { "date": "2024-6-4", "count": 2 },
        { "date": "2024-6-5", "count": 36 },
        { "date": "2024-6-6", "count": 20 },
        { "date": "2024-6-8", "count": 127 },
        { "date": "2024-6-9", "count": 72 },
        { "date": "2024-6-10", "count": 39 },
        { "date": "2024-6-11", "count": 52 },
        { "date": "2024-6-12", "count": 6 },
        { "date": "2024-6-13", "count": 4 },
        { "date": "2024-6-14", "count": 22 },
        { "date": "2024-6-15", "count": 6 },
        { "date": "2024-6-16", "count": 24 },
        { "date": "2024-6-17", "count": 5 },
        { "date": "2024-6-18", "count": 18 },
        { "date": "2024-6-20", "count": 11 },
        { "date": "2024-6-21", "count": 34 },
        { "date": "2024-6-22", "count": 5 },
        { "date": "2024-6-23", "count": 9 },
        { "date": "2024-6-25", "count": 19 },
        { "date": "2024-6-26", "count": 65 },
        { "date": "2024-6-28", "count": 19 },
        { "date": "2024-6-29", "count": 63 },
        { "date": "2024-6-30", "count": 4 },
        { "date": "2024-7-1", "count": 7 },
        { "date": "2024-7-2", "count": 34 },
        { "date": "2024-7-3", "count": 11 },
        { "date": "2024-7-4", "count": 30 },
        { "date": "2024-7-5", "count": 10 },
        { "date": "2024-7-6", "count": 45 },
        { "date": "2024-7-7", "count": 3 },
        { "date": "2024-7-8", "count": 5 },
        { "date": "2024-7-9", "count": 8 },
        { "date": "2024-7-10", "count": 5 },
        { "date": "2024-7-13", "count": 2 },
        { "date": "2024-7-15", "count": 4 },
        { "date": "2024-7-16", "count": 5 },
        { "date": "2024-7-17", "count": 23 },
        { "date": "2024-7-18", "count": 13 },
        { "date": "2024-7-19", "count": 13 },
        { "date": "2024-7-20", "count": 8 },
        { "date": "2024-7-21", "count": 30 },
        { "date": "2024-7-22", "count": 1 },
        { "date": "2024-7-23", "count": 15 },
        { "date": "2024-7-24", "count": 34 },
        { "date": "2024-7-25", "count": 7 },
        { "date": "2024-7-26", "count": 42 },
        { "date": "2024-7-27", "count": 21 },
        { "date": "2024-7-28", "count": 5 },
        { "date": "2024-7-30", "count": 12 },
        { "date": "2024-7-31", "count": 14 },
        { "date": "2024-8-1", "count": 28 },
        { "date": "2024-8-2", "count": 3 },
        { "date": "2024-8-3", "count": 4 },
        { "date": "2024-8-4", "count": 28 },
        { "date": "2024-8-5", "count": 18 },
        { "date": "2024-8-6", "count": 24 },
        { "date": "2024-8-7", "count": 46 },
        { "date": "2024-8-8", "count": 5 },
        { "date": "2024-8-9", "count": 19 },
        { "date": "2024-8-10", "count": 13 },
        { "date": "2024-8-11", "count": 20 },
        { "date": "2024-8-12", "count": 3 },
        { "date": "2024-8-14", "count": 49 },
        { "date": "2024-8-15", "count": 38 },
        { "date": "2024-8-16", "count": 2 },
        { "date": "2024-8-17", "count": 2 },
        { "date": "2024-8-18", "count": 14 },
        { "date": "2024-8-19", "count": 12 },
        { "date": "2024-8-20", "count": 2 },
        { "date": "2024-8-21", "count": 21 },
        { "date": "2024-8-22", "count": 2 },
        { "date": "2024-8-23", "count": 39 },
        { "date": "2024-8-24", "count": 5 },
        { "date": "2024-8-25", "count": 3 },
        { "date": "2024-8-27", "count": 31 },
        { "date": "2024-8-28", "count": 3 },
        { "date": "2024-8-29", "count": 4 },
        { "date": "2024-8-30", "count": 6 },
        { "date": "2024-9-1", "count": 10 },
        { "date": "2024-9-3", "count": 21 },
        { "date": "2024-9-4", "count": 13 },
        { "date": "2024-9-6", "count": 3 },
        { "date": "2024-9-7", "count": 11 },
        { "date": "2024-9-8", "count": 3 },
        { "date": "2024-9-9", "count": 9 },
        { "date": "2024-9-10", "count": 5 },
        { "date": "2024-9-11", "count": 9 },
        { "date": "2024-9-12", "count": 30 },
        { "date": "2024-9-13", "count": 45 },
        { "date": "2024-9-14", "count": 47 },
        { "date": "2024-9-15", "count": 1 },
        { "date": "2024-9-16", "count": 26 },
        { "date": "2024-9-17", "count": 44 },
        { "date": "2024-9-18", "count": 18 },
        { "date": "2024-9-19", "count": 16 },
        { "date": "2024-9-20", "count": 63 },
        { "date": "2024-9-21", "count": 3 },
        { "date": "2024-9-23", "count": 55 },
        { "date": "2024-9-24", "count": 23 },
        { "date": "2024-9-26", "count": 31 },
        { "date": "2024-9-27", "count": 67 },
        { "date": "2024-9-28", "count": 9 },
        { "date": "2024-9-29", "count": 1 },
        { "date": "2024-9-30", "count": 19 },
        { "date": "2024-10-1", "count": 51 },
        { "date": "2024-10-2", "count": 1 },
        { "date": "2024-10-3", "count": 15 },
        { "date": "2024-10-4", "count": 15 },
        { "date": "2024-10-7", "count": 13 },
        { "date": "2024-10-8", "count": 26 },
        { "date": "2024-10-9", "count": 27 },
        { "date": "2024-10-11", "count": 5 },
        { "date": "2024-10-12", "count": 45 },
        { "date": "2024-10-13", "count": 17 },
        { "date": "2024-10-14", "count": 1 },
        { "date": "2024-10-15", "count": 37 },
        { "date": "2024-10-16", "count": 2 },
        { "date": "2024-10-17", "count": 20 },
        { "date": "2024-10-18", "count": 4 },
        { "date": "2024-10-20", "count": 7 },
        { "date": "2024-10-21", "count": 64 },
        { "date": "2024-10-22", "count": 27 },
        { "date": "2024-10-23", "count": 4 },
        { "date": "2024-10-24", "count": 19 },
        { "date": "2024-10-25", "count": 6 },
        { "date": "2024-10-26", "count": 54 },
        { "date": "2024-10-29", "count": 23 },
        { "date": "2024-10-30", "count": 6 },
        { "date": "2024-10-31", "count": 7 },
        { "date": "2024-11-1", "count": 3 },
        { "date": "2024-11-2", "count": 12 },
        { "date": "2024-11-4", "count": 7 },
        { "date": "2024-11-5", "count": 15 },
        { "date": "2024-11-6", "count": 33 },
        { "date": "2024-11-7", "count": 17 },
        { "date": "2024-11-8", "count": 21 },
        { "date": "2024-11-10", "count": 69 },
        { "date": "2024-11-11", "count": 11 },
        { "date": "2024-11-12", "count": 6 },
        { "date": "2024-11-13", "count": 41 },
        { "date": "2024-11-15", "count": 21 },
        { "date": "2024-11-16", "count": 50 },
        { "date": "2024-11-17", "count": 22 },
        { "date": "2024-11-18", "count": 23 },
        { "date": "2024-11-19", "count": 20 },
        { "date": "2024-11-20", "count": 24 },
        { "date": "2024-11-21", "count": 10 },
        { "date": "2024-11-22", "count": 14 },
        { "date": "2024-11-23", "count": 9 },
        { "date": "2024-11-24", "count": 2 },
        { "date": "2024-11-25", "count": 12 },
        { "date": "2024-11-26", "count": 6 },
        { "date": "2024-11-27", "count": 26 },
        { "date": "2024-11-28", "count": 34 },
        { "date": "2024-11-29", "count": 18 },
        { "date": "2024-11-30", "count": 27 },
        { "date": "2024-12-1", "count": 2 },
        { "date": "2024-12-2", "count": 19 },
        { "date": "2024-12-3", "count": 10 },
        { "date": "2024-12-5", "count": 19 },
        { "date": "2024-12-6", "count": 3 },
        { "date": "2024-12-8", "count": 12 },
        { "date": "2024-12-9", "count": 31 },
        { "date": "2024-12-10", "count": 24 },
        { "date": "2024-12-11", "count": 19 },
        { "date": "2024-12-12", "count": 20 },
        { "date": "2024-12-13", "count": 61 },
        { "date": "2024-12-14", "count": 10 },
        { "date": "2024-12-15", "count": 4 },
        { "date": "2024-12-16", "count": 40 },
        { "date": "2024-12-17", "count": 10 },
        { "date": "2024-12-18", "count": 10 },
        { "date": "2024-12-19", "count": 13 },
        { "date": "2024-12-20", "count": 9 },
        { "date": "2024-12-21", "count": 52 },
        { "date": "2024-12-22", "count": 22 },
        { "date": "2024-12-23", "count": 22 },
        { "date": "2024-12-24", "count": 25 },
        { "date": "2024-12-26", "count": 10 },
        { "date": "2024-12-30", "count": 14 },
        { "date": "2024-12-31", "count": 45 }
      ],
      "format": {
        "type": "json",
        "parse": { "count": "number", "date": "date" }
      },
      "transform": [
        {
          "type": "formula",
          "expr": "datum.count",
          "as": "value"
        },
        {
          "type": "formula",
          "expr": "year(datum.date)",
          "as": "year"
        },
        {
          "type": "timeunit",
          "field": "date",
          "units": ["year", "week"],
          "as": ["w0", "w1"]
        },

        {
          "type": "formula",
          "expr": "timeOffset('day', datum.w0)",
          "as": "w0"
        },
        {
          "type": "timeunit",
          "field": "date",
          "units": ["day"],
          "as": ["d0", "d1"]
        }
      ]
    }
  ],

  "scales": [
    {
      "name": "y",
      "type": "band",
      "domain": { "data": "data", "field": "d0", "sort": true },
      "range": [0, { "signal": "height" }]
    },
    {
      "name": "color",
      "type": "linear",
      "clamp": true,
      "range": { "scheme": { "signal": "scheme" } },
      "domain": { "data": "data", "field": "count" }
    }
  ],

  "layout": {
    "columns": 1,
    "padding": 15
  },

  "marks": [
    {
      "type": "group",

      "from": {
        "facet": {
          "data": "data",
          "name": "values",
          "groupby": "year"
        }
      },

      "sort": {
        "field": "datum.year",
        "order": "descending"
      },

      "data": [
        {
          "name": "max",
          "source": "values",
          "transform": [
            { "type": "aggregate", "ops": ["max"], "fields": ["date"] }
          ]
        },
        {
          "name": "weeks",
          "transform": [
            { "type": "sequence", "start": 0, "stop": 53, "as": "weeknum" },
            {
              "type": "formula",
              "expr": "datetime(parent.year, 0, 1 + datum.weeknum * 7)",
              "as": "date"
            },
            {
              "type": "timeunit",
              "units": ["year", "week"],
              "field": "date",
              "as": ["w0", "w1"]
            },
            {
              "type": "formula",
              "expr": "timeOffset('day', datum.w0)",
              "as": "w0"
            },
            { "type": "filter", "expr": "datum.date < data('max')[0].max_date" }
          ]
        }
      ],

      "scales": [
        {
          "name": "x",
          "type": "band",
          "domain": { "data": "weeks", "field": "w0", "sort": true },
          "range": [0, { "signal": "width" }]
        }
      ],

      "axes": [
        {
          "orient": "left",
          "scale": "y",
          "ticks": false,
          "domain": false,
          "labelPadding": 8,
          "format": "%a",
          "formatType": "time",
          "title": { "signal": "parent.year" },
          "titleAngle": 0,
          "titleAlign": "right",
          "titleX": -8,
          "titleY": -2,
          "titleFontSize": 10
        },
        {
          "orient": "top",
          "scale": "x",
          "ticks": false,
          "domain": false,
          "format": "%b",
          "formatType": "time",
          "labelAlign": "left",
          "encode": {
            "labels": {
              "update": {
                "x": {
                  "scale": "x",
                  "field": "value",
                  "band": 0,
                  "offset": { "signal": "month(datum.value) * offset" }
                },
                "opacity": { "signal": "date(datum.value) < 8 ? 1 : 0" }
              }
            }
          }
        }
      ],

      "marks": [
        {
          "type": "rect",
          "from": { "data": "values" },
          "encode": {
            "enter": {
              "x": {
                "scale": "x",
                "field": "w0",
                "offset": { "signal": "month(datum.date) * offset" }
              },
              "width": { "scale": "x", "band": 1, "offset": -1 },
              "y": { "scale": "y", "field": "d0" },
              "height": { "scale": "y", "band": 1, "offset": -1 },
              "cornerRadius": { "value": 2 },
              "tooltip": {
                "signal": "{'Date': timeFormat(datum.date, '%a %b %d, %Y'), 'Songs count': datum.count}"
              }
            },
            "update": {
              "fill": { "scale": "color", "field": "value" }
            }
          }
        }
      ]
    }
  ],
  "config": {
    "text": {
      "color": "rgb(224, 224, 224)",
      "font": "monospace",
      "lineHeight": 1.6,
      "fontSize": 12
    },
    "axis": {
      "labelColor": "rgb(224, 224, 224)",
      "titleColor": "rgb(224, 224, 224)",
      "tickColor": "rgb(224, 224, 224)",
      "domainColor": "rgb(224, 224, 224)",
      "labelFontSize": 12,
      "titleFontSize": 12
    },
    "style": {
      "cell": {
        "stroke": "transparent"
      }
    },
    "title": { "color": "rgb(224, 224, 224)" }
  },
  "width": "container",
  "height": 300
}
